<style>
  .delete-btn:hover{
    cursor: pointer;
  }

  .delete-btn {
    padding: 3px;
  }

  .modal-overlay{
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); 
    z-index: 1000; 
  }

  .modal {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 20px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
    z-index: 1001; 
    width: 60%;
    height: 80%;
    border-radius: 15px;
    overflow: hidden;
  }

  .scrollable {
    height: 60vh; 
    overflow-y: auto; 
    margin-top: 1em;
    border: 1px solid lightgray;
    border-radius: 5px;
    padding: 1em;
  }

  .dataset-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .dataset-item:hover {
    background-color: lightgray;
  }

  .dataset-item a {
    flex-grow: 1; 
  }

  .dataset-item button {
    margin-left: auto;
  }

  .text-center {
    padding: 5px 0 20px  0;
  }


</style>


<div id="modal-overlay" class="modal-overlay"></div>
<div id="modal" class="modal" style="display:none;">
  <h2 class="text-center">Saved Datasets</h2>
  <span onclick="closeModal()" style="position:absolute; top:10px; right:15px; font-size:20px; cursor:pointer;">&times;</span>

  <input type="text" id="search-bar" placeholder="Search Datasets" onkeyup="filterDatasets()">
  <br><br>
  <div class="scrollable" id="datasets-container">
  <% if @datasets.present? %>
  <% @datasets.each do |dataset| %>
    <div class="dataset-item" data-title="<%= dataset.title.downcase %>">
      <a href='<%= dataset.url %>' target="_blank" rel="nofollow"><%= dataset.title %></a>
      <button class="button delete-btn" onclick="deleteDataset('<%= dataset.dataset_id %>')">Delete</button>
    </div>
  <% end %>
<% else %>
  <p>Nessun dataset salvato</p>
<% end %>

  </div>
</div>

<script>
  function openModal() {
    document.getElementById("modal-overlay").style.display = "block";
    document.getElementById("modal").style.display = "block";
  }
  function closeModal() {
    document.getElementById("modal-overlay").style.display = "none";
    document.getElementById("modal").style.display = "none";
  }

  document.getElementById("showFavourites").addEventListener("click", openModal);

  function filterDatasets() {
    const input = document.getElementById("search-bar").value.toLowerCase();
    const items = document.querySelectorAll(".dataset-item");
    items.forEach(item => {
      const title = item.getAttribute("data-title");
      item.style.display = title.includes(input) ? "flex" : "none";
    });
  }

  function deleteDataset(id) {
    if (!confirm("Sei sicuro di voler eliminare questo dataset?")) return;
    const item = document.querySelector(`.dataset-item button[onclick*="${id}"]`).parentNode;
    item.remove();
  }

  document.addEventListener("DOMContentLoaded", function() {
  const btn = document.getElementById("showFavourites");
  if (btn) {
    btn.addEventListener("click", openModal);
  }
});

</script>
